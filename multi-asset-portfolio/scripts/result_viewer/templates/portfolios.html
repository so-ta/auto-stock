{% extends "base.html" %}

{% block title %}ポートフォリオ一覧{% endblock %}

{% block extra_css %}
<style>
    .portfolio-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
    }

    .portfolio-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .portfolio-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    .portfolio-header {
        padding: 1.5rem;
        background: linear-gradient(135deg, var(--dark-color) 0%, #34495e 100%);
        color: white;
    }

    .portfolio-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .portfolio-id {
        font-size: 0.8rem;
        opacity: 0.7;
    }

    .portfolio-body {
        padding: 1.5rem;
    }

    .portfolio-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .portfolio-stat {
        text-align: center;
    }

    .portfolio-stat-value {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--dark-color);
    }

    .portfolio-stat-label {
        font-size: 0.75rem;
        color: #666;
        text-transform: uppercase;
    }

    .schedule-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .schedule-badge.enabled {
        background-color: #d4edda;
        color: #155724;
    }

    .schedule-badge.disabled {
        background-color: #f8d7da;
        color: #721c24;
    }

    .portfolio-actions {
        display: flex;
        gap: 0.5rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
    }

    .portfolio-actions .btn {
        flex: 1;
        text-align: center;
    }

    .empty-portfolio {
        text-align: center;
        padding: 4rem 2rem;
        color: #666;
    }

    .empty-portfolio h3 {
        margin-bottom: 1rem;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dark-color);
    }

    .currency-jpy::before {
        content: '¥';
    }

    .currency-usd::before {
        content: '$';
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2 class="page-title">ポートフォリオ管理</h2>
    <a href="/portfolios/new" class="btn btn-primary">+ 新規ポートフォリオ</a>
</div>

{% if portfolios %}
<div class="portfolio-grid">
    {% for item in portfolios %}
    <div class="portfolio-card">
        <div class="portfolio-header">
            <div class="portfolio-name">{{ item.config.name }}</div>
            <div class="portfolio-id">ID: {{ item.config.id }}</div>
        </div>
        <div class="portfolio-body">
            <div class="portfolio-stats">
                <div class="portfolio-stat">
                    <div class="portfolio-stat-value">
                        {% if item.holdings %}
                            {% if item.config.currency == 'JPY' %}
                            ¥{{ "{:,.0f}".format(item.holdings.total_value) }}
                            {% else %}
                            ${{ "{:,.2f}".format(item.holdings.total_value) }}
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </div>
                    <div class="portfolio-stat-label">総資産</div>
                </div>
                <div class="portfolio-stat">
                    <div class="portfolio-stat-value">
                        {% if item.holdings %}
                        {{ item.holdings.positions | length }}
                        {% else %}
                        0
                        {% endif %}
                    </div>
                    <div class="portfolio-stat-label">銘柄数</div>
                </div>
                <div class="portfolio-stat">
                    <div class="portfolio-stat-value">
                        {% if item.config.currency == 'JPY' %}
                        ¥{{ "{:,.0f}".format(item.config.initial_capital) }}
                        {% else %}
                        ${{ "{:,.2f}".format(item.config.initial_capital) }}
                        {% endif %}
                    </div>
                    <div class="portfolio-stat-label">初期資本</div>
                </div>
                <div class="portfolio-stat">
                    <div class="portfolio-stat-value">
                        <span class="schedule-badge {{ 'enabled' if item.config.schedule.enabled else 'disabled' }}">
                            {% if item.config.schedule.enabled %}
                            {{ "%02d:%02d"|format(item.config.schedule.hour, item.config.schedule.minute) }}
                            {% else %}
                            無効
                            {% endif %}
                        </span>
                    </div>
                    <div class="portfolio-stat-label">スケジュール</div>
                </div>
            </div>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 0;">
                {{ item.config.description or '説明なし' }}
            </p>
            <div class="portfolio-actions">
                <a href="/portfolios/{{ item.config.id }}" class="btn btn-primary btn-sm">詳細</a>
                <a href="/portfolios/{{ item.config.id }}/holdings" class="btn btn-secondary btn-sm">保有資産</a>
                <a href="/portfolios/{{ item.config.id }}/edit" class="btn btn-secondary btn-sm">編集</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card empty-portfolio">
    <h3>ポートフォリオがありません</h3>
    <p>「新規ポートフォリオ」ボタンから最初のポートフォリオを作成してください。</p>
    <a href="/portfolios/new" class="btn btn-primary">+ 新規ポートフォリオを作成</a>
</div>
{% endif %}
{% endblock %}
