# 設計レビューチェックリスト

QA-008: コード品質の継続的維持のためのチェックリスト

## 使い方

Pull Request作成時、以下のチェックリストを使用して自己レビューを行ってください。
全ての項目にチェックが入るか、該当しない理由が明確な場合のみマージしてください。

---

## コード品質

### 設計原則
- [ ] **単一責任原則（SRP）**: 各クラス/関数は1つの責任のみを持っているか
- [ ] **開放閉鎖原則（OCP）**: 拡張に対して開かれ、修正に対して閉じているか
- [ ] **依存性逆転原則（DIP）**: 具象ではなく抽象に依存しているか
- [ ] **DRY原則**: 重複コードがないか（3回以上の重複は共通化を検討）

### ファイルサイズ
- [ ] 各ファイルが**400行以下**か（推奨上限）
- [ ] 500行を超えるファイルがある場合、分割の計画があるか
- [ ] 1000行を超えるファイルがないか（**必須要件**）

### 命名規則
- [ ] クラス名は`PascalCase`で、名詞で始まっているか
- [ ] 関数名は`snake_case`で、動詞で始まっているか
- [ ] 変数名は意図が明確か（`x`, `tmp`などの不明瞭な名前を避ける）
- [ ] 定数は`UPPER_SNAKE_CASE`か

### 型ヒント
- [ ] 全ての関数に引数と戻り値の型ヒントが付与されているか
- [ ] `Optional`や`Union`が適切に使用されているか
- [ ] 複雑な型は`TypeAlias`で定義されているか

---

## テスト

### ユニットテスト
- [ ] 新規コードに対応するユニットテストが追加されているか
- [ ] テストは独立しており、他のテストに依存していないか
- [ ] エッジケース（境界値、空入力、異常値）がテストされているか
- [ ] モックは必要最小限に抑えられているか

### 統合テスト
- [ ] モジュール間連携の変更がある場合、統合テストが更新されているか
- [ ] 外部システム（API、DB）との連携部分がテストされているか

### カバレッジ
- [ ] 新規コードのカバレッジが80%以上か
- [ ] 重要なビジネスロジックは90%以上のカバレッジか
- [ ] カバレッジが低下していないか（`pytest --cov`で確認）

---

## アーキテクチャ

### レイヤー構造
- [ ] 適切なレイヤー（data/signals/meta/allocation/backtest/orchestrator）に配置されているか
- [ ] レイヤー間の依存方向が正しいか（下位→上位の依存のみ）
- [ ] 循環依存が発生していないか

### 既存パターンとの整合性
- [ ] 既存の設計パターン（Factory, Strategy, Observer等）に従っているか
- [ ] 類似機能の実装方法と一貫性があるか
- [ ] 設定はdataclass + YAMLパターンを使用しているか

### 依存関係
- [ ] 新しい外部依存関係は最小限か
- [ ] 依存関係は`pyproject.toml`に追加されているか
- [ ] オプション依存は`try/except`でgraceful degradationされているか

---

## パフォーマンス

### 計算効率
- [ ] ループ内での不要な計算がないか
- [ ] 大きなデータセットに対してベクトル化されているか
- [ ] キャッシュが適切に使用されているか

### メモリ効率
- [ ] 不要なデータのコピーがないか
- [ ] ジェネレータが適切に使用されているか
- [ ] 大きなオブジェクトの参照が適切に管理されているか

---

## エラーハンドリング

### 例外処理
- [ ] 適切な例外クラスが使用されているか
- [ ] 例外が握りつぶされていないか（`except: pass`は禁止）
- [ ] エラーメッセージが具体的で、デバッグに役立つか

### ログ出力
- [ ] 重要な処理にログが追加されているか
- [ ] ログレベルが適切か（DEBUG/INFO/WARNING/ERROR）
- [ ] 機密情報がログに出力されていないか

---

## セキュリティ

### 入力検証
- [ ] 外部入力（ユーザー入力、API応答）が検証されているか
- [ ] SQLインジェクション、コマンドインジェクションの脆弱性がないか
- [ ] ファイルパスの検証が行われているか

### 機密情報
- [ ] APIキー、パスワードがハードコードされていないか
- [ ] 機密情報が環境変数または設定ファイルから読み込まれているか
- [ ] `.gitignore`に機密ファイルが追加されているか

---

## ドキュメント

### コード内ドキュメント
- [ ] 公開API（public関数/クラス）にdocstringがあるか
- [ ] docstringはGoogle/NumPyスタイルに従っているか
- [ ] 複雑なロジックにはインラインコメントがあるか

### 外部ドキュメント
- [ ] READMEの更新が必要な変更ではないか確認したか
- [ ] 重要なアーキテクチャ変更は`docs/`に文書化されているか
- [ ] 破壊的変更はCHANGELOGに記載されているか

---

## チェック完了確認

### 自動チェック
- [ ] `pre-commit run --all-files` がパスするか
- [ ] `pytest` が全てパスするか
- [ ] `mypy` が警告なしで通るか

### 手動確認
- [ ] コードを声に出して読み上げられるか（明確で理解しやすいか）
- [ ] 6ヶ月後の自分が理解できるか
- [ ] チームメンバーにレビューを依頼する準備ができているか

---

## 追加メモ

変更に関する補足事項や、チェックリストに該当しない項目についてのメモ:

```
（ここに記入）
```

---

*このチェックリストは継続的に改善されます。改善提案があれば Issue を作成してください。*
